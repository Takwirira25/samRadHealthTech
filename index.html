<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>samRad Health Technologies</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;600;700&display=Cursive" rel="stylesheet">
        <meta name="description" content="Visionary projects to advance cancer detection mechanisms">
<meta name="keywords" content="samrad, health, technologies">
<meta name="robots" content="index, follow">
<title>samRad Health Technologies</title>
    <style>
        /* Base Styles */
        body {
            font-family: 'Segoe UI', sans-serif;
            margin: 0;
            background: linear-gradient(to right, #f8fbff, #e9f0f8); /* Softer, lighter gradient */
            color: #333;
            line-height: 1.6;
            scroll-behavior: smooth;
        }

        /* Header */
        header {
            background: linear-gradient(to right, #001f3f, #003366); /* Deeper blue gradient */
            color: #fff;
            padding: 0.3rem 1.5rem; /* Constant, minimal padding */
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            position: sticky;
            top: 0;
            z-index: 1000;
            display: flex;
            flex-direction: column; /* Stacks title and nav vertically for desktop */
            align-items: center;
            text-align: center;
        }

        header h1 {
            margin: 0; /* Remove default margin to reduce vertical space */
            font-size: 2.0rem; /* Fixed, minimal font size for constant header */
            color: #c9e6ff;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3),
                         4px 4px 8px rgba(0,0,0,0.2),
                         6px 6px 12px rgba(0,0,0,0.1);
            letter-spacing: 0.05rem;
            line-height: 1.2; /* Adjust line height to reduce space above/below text */
            white-space: nowrap; /* Keep the title on one line */
        }
        
        /* Navigation (Desktop) */
        nav.nav-links {
            margin-top: 0.5rem; /* Minimal margin from title */
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            flex-wrap: wrap;
        }

        nav a {
            color: #e0f2f7;
            text-decoration: none;
            font-weight: 600;
            position: relative;
            white-space: nowrap;
            padding-bottom: 5px;
            transition: color 0.2s ease;
            font-size: 0.95rem;
        }

        nav a::after {
            content: '';
            display: block;
            width: 0;
            height: 2px;
            background: #89cff0;
            transition: width 0.2s ease-in-out;
            position: absolute;
            bottom: 0;
            left: 0;
        }

        nav a:hover,
        nav a.active {
            color: #fff;
        }

        nav a:hover::after,
        nav a.active::after {
            width: 100%;
        }

        /* Mobile Menu Toggle (hidden by default on desktop) */
        .menu-toggle {
            display: none;  
            background: none;
            border: none;
            font-size: 1.8rem;
            color: #fff;
            cursor: pointer;
            margin-top: 0.5rem;
            padding: 5px 10px;
            border-radius: 5px;
            transition: background-color 0.2s ease, margin-top 0.2s ease-out;
        }

        /* Main Container */
        .container {
            padding: 3rem 6vw;
            max-width: 1300px;
            margin: 0 auto;
            animation: fadeIn 1.2s ease-out;
        }

        /* Headings */
        h1, h2 {
            color: #001f3f;
            margin-bottom: 1.2rem;
        }

        h2 {
            color: #001f3f;
            font-size: 2rem;
            border-bottom: 2px solid #d0e0f0;
            padding-bottom: 0.7rem;
            position: relative;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2),
                         2px 2px 4px rgba(0,0,0,0.15);
        }

        h2::before {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 50px;
            height: 3px;
            background: #007bff;
        }

        /* Sections */
        section {
            margin-bottom: 3.5rem;
            padding: 2rem;
            border-radius: 12px;
            background-color: #ffffff;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            transition: all 0.4s ease;
        }

        section.active-section {
            background: #eef7ff;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        /* Services Grid */
        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .service-card {
            background: #ffffff;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            border-left: 6px solid #007bff;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .service-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.2);
        }

        .service-card h3 {
            margin-top: 0;
            color: #001f3f;
            font-size: 1.4rem;
            margin-bottom: 0.8rem;
        }

        .service-card p {
            color: #555;
        }

        /* Buttons */
        button {
            background-color: #007bff;
            color: #fff;
            border: none;
            padding: 0.9rem 1.8rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.05rem;
            font-weight: 600;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            display: inline-block;
            margin-right: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        button:hover {
            background-color: #0056b3;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        button:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Quiz Specific Styles */
        #quiz-form label {
            display: block;
            margin-bottom: 0.8rem;
            cursor: pointer;
            font-size: 1.05rem;
            color: #444;
            transition: color 0.2s ease;
        }

        #quiz-form label:hover {
            color: #007bff;
        }

        #quiz-form label input[type="radio"] {
            margin-right: 0.8rem;
            transform: scale(1.2);
        }

        #quiz-result p {
            margin-bottom: 0.8rem;
            font-size: 1.1rem;
        }

        /* Radiation Animation Styles */
        #animation-container-horizontal {
            position: relative;
            width: 100%;
            max-width: 450px;
            height: 300px;
            margin: 2.5rem auto;
            background: #f0f7ff; /* This is the background for the entire scene */
            border-radius: 15px;
            overflow: hidden;
            border: 2px solid #cce0f0;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.05);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .gantry-circle {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(0deg);
            width: 240px; /* This is now the OUTER diameter of the ring */
            height: 240px; /* This is now the OUTER diameter of the ring */
            border-radius: 50%;
            z-index: 4;
            transition: transform 0.1s linear;
            /* --- CRITICAL CHANGE: Use multiple inset box-shadows to create the ring --- */
            background: transparent; /* Ensures the center of the div is transparent */
            border: none; /* Remove any default border */
            box-shadow:
                inset 0 0 0 15px #555, /* Innermost part of the ring */
                inset 0 0 0 30px #444, /* Outer part of the ring for a gradient-like effect */
                0 0 15px rgba(0,0,0,0.3); /* Outer shadow for depth */
        }

        .gantry-head {
            width: 35px;
            height: 35px;
            background: #222;
            border-radius: 50%;
            position: absolute;
            /* Adjust top to account for the new gantry ring thickness (approx 30px total for the visual ring) */
            top: -27px; /* (Roughly: (gantry_visual_radius - head_radius/2) to place on outer edge of ring) */
            left: calc(50% - 17.5px);
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }

        /* Styling for the container that holds the human figure */
        .human-body-silhouette {
            position: relative;
            width: 80px; /* Base width of the human figure's area */
            height: 180px; /* Base height of the human figure's area */
            z-index: 2;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Styling for the SVG element itself within the container */
        .human-body-silhouette svg {
            width: 100%; /* Makes the SVG take up the full width of its container */
            height: 100%; /* Makes the SVG take up the full height of its container */
            stroke: #d9a78b; /* This is a fallback outline color, though the path will use the gradient */
            stroke-width: 2px; /* This stroke-width applies to any other SVG paths, not the main stick figure */
            filter: drop-shadow(2px 2px 3px rgba(0,0,0,0.2)); /* Subtle drop shadow for depth */
        }

        /* --- THIS IS THE KEY PART FOR THE STICK FIGURE'S THICKNESS --- */
        /* Styling specifically for the <path> element that draws the stick figure */
        .human-body-silhouette svg path:first-of-type {
            fill: none; /* Ensures the stick figure is just lines, not filled */
            stroke: url(#humanGradient); /* Applies the cool-toned gradient to the lines */
            stroke-width: 25; /* <<-- MUCH THICKER NOW! */
        }

        .tumor {
            position: absolute;
            width: 20px; /* Increased initial size */
            height: 20px; /* Increased initial size */
            background: radial-gradient(circle, #cc0000, #800000);
            border-radius: 50%;
            z-index: 3;
            box-shadow: 0 0 12px 2px rgba(200,0,0,0.8); /* Adjusted shadow for larger size */
            transform: scale(1);
            opacity: 1;
            transition: transform 0.5s ease-out, opacity 0.5s ease-out;
            top: 55%;
            left: 50%;
            transform: translate(-50%, -50%) scale(1);
        }

        .tumor.glowing {
            animation: tumorGlow 0.8s infinite alternate ease-in-out;
        }

        @keyframes tumorGlow {
            from { box-shadow: 0 0 12px 2px rgba(200,0,0,0.8); } /* Adjusted glow for larger size */
            to { box-shadow: 0 0 25px 5px rgba(255,50,50,0.9); } /* Brighter, larger glow */
        }

        .beam {
            position: absolute;
            height: 12px; /* Increased beam height for visibility */
            width: 0;
            /* More intense reddish-orange gradient */
            background: linear-gradient(to right, rgba(255, 100, 0, 0.95), rgba(255, 20, 0, 1));  
            top: 50%;
            left: 50%;
            /* transform-origin will be set by JS */
            transform: translateY(-50%) rotate(0deg); /* Explicitly set to 0deg for a straight horizontal line */
            box-shadow: 0 0 50px rgba(255, 50, 0, 1.2); /* More intense glow */
            border-radius: 6px; /* Slightly larger border-radius for thicker beam */
            z-index: 4;
            opacity: 0;
            transition: width 0.1s linear, opacity 0.1s linear;
        }

        .beam.firing {
            animation: beamPulse 0.3s infinite alternate; /* Pulsating effect */
        }

        @keyframes beamPulse {
            from { box-shadow: 0 0 40px rgba(255, 100, 0, 1); } /* More intense pulse glow */
            to { box-shadow: 0 0 80px 10px rgba(255, 20, 0, 1.5); } /* More intense pulse glow */
        }

        .patient-table {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 80px;
            background-color: #777;
            border-top: 10px solid #555;
            z-index: 1;
            box-shadow: inset 0 5px 10px rgba(0,0,0,0.2); /* Inner shadow for depth */
        }
        .patient-table::before {
            content: '';
            position: absolute;
            top: -10px;
            left: 20%;
            width: 60%;
            height: 10px;
            background-color: #aaa;
            border-top-left-radius: 5px;
            border-top-right-radius: 5px;
        }
        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            header {
                padding: 0.3rem 1rem; /* Reduced padding for mobile */
            }

            header h1 {
                font-size: 1.5rem; /* Smaller font for mobile header */
                white-space: nowrap; /* Ensure it stays on one line */
                overflow: hidden; /* Hide overflow if it somehow goes beyond */
                text-overflow: ellipsis; /* Add ellipsis if hidden */
            }

            nav.nav-links {
                /* No flex-direction: column; to keep links horizontal */
                gap: 0.3rem; /* Reduced gap between links */
                margin-top: 0.3rem; /* Reduced margin from title */
                justify-content: space-around; /* Distribute space more evenly */
                flex-wrap: wrap; /* Allow wrapping if absolutely necessary, but try to prevent */
            }

            nav a {
                font-size: 0.75rem; /* Even smaller font for nav links */
                padding: 3px 0.1rem; /* Reduced vertical and horizontal padding for tighter fit */
            }

            .container {
                padding: 2rem 4vw; /* Slightly less padding on sides for mobile */
            }

            h2 {
                font-size: 1.7rem; /* Smaller headings on mobile */
                padding-bottom: 0.5rem;
            }

            section {
                padding: 1.5rem; /* Reduced section padding */
            }

            .service-card {
                padding: 1.5rem; /* Reduced service card padding */
            }

            button {
                padding: 0.7rem 1.4rem; /* Smaller button padding */
                font-size: 0.95rem; /* Smaller button font */
            }
        }
        
        /* Further optimization for very small screens */
        @media (max-width: 480px) {
            header h1 {
                font-size: 1.2rem; /* Even smaller font for very small mobile header */
            }
            nav a {
                font-size: 0.65rem; /* Even smaller font for very small mobile nav links */
                padding: 2px 0.05rem; /* Even tighter padding */
            }
        }

    </style>
</head>
<body>

    <header>
        <h1>samRad Health Technologies</h1>
        <nav class="nav-links">
            <a href="#about">About</a>
            <a href="#services">Services</a>
            <a href="#continuous-improvement">Advancements</a>
            <a href="#certifications">Certifications</a>
            <a href="#quiz">Imaging & Quiz</a>
            <a href="#radiation-animation">Radiation Simulation</a>
            <a href="#contact">Contact</a>
        </nav>
    </header>

    <div class="container">
         <section id="about" class="py-16 px-4 sm:px-6 lg:px-8 bg-gray-50 dark:bg-gray-800 rounded-lg shadow-md">
    <div class="max-w-4xl mx-auto text-center">
        <h2 class="text-4xl font-extrabold mb-6">About Us</h2>
        <p class="text-lg leading-relaxed mb-4">samRad Health Technologies is a visionary cancer research and healthtech enterprise. Our mission is to pioneer intelligent, automated systems that empower clinicians to detect and quantify tumors from radiological imaging with precision and ease. Our AI pipelines are open, transparent, and designed to speed up diagnostics and enhance medical research.</p>
        <p class="text-lg leading-relaxed mb-4">Founded by <strong>Samuel</strong> B. <strong>Takwirira</strong>, a Zimbabwean PhD student in Physics at the University of New Hampshire in the United States, the initiative is rooted in a passion for oncology and a heartfelt commitment to expanding access to care. Coming from a background marked by economic hardship and limited access to advanced healthcare, <strong>Takwirira</strong> has firsthand experience of the challenges faced by most African communities.</p>
        <p class="text-lg leading-relaxed mb-4">Through resilience and a relentless pursuit of education, he now seeks to transform lives&mdash;not just through innovation, but by creating pathways for others from similar circumstances. samRad Health Technologies aspires to forge partnerships with hospitals across Zimbabwe and Southern Africa, uplifting cancer care through technological excellence and shared knowledge.</p>
    </div>
</section>

<section id="services" class="py-16 px-4 sm:px-6 lg:px-8 bg-white dark:bg-gray-900 rounded-lg shadow-md mt-8">
    <div class="max-w-6xl mx-auto text-center">
        <h2 class="text-4xl font-extrabold mb-8">Our Services</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            <div class="service-card bg-gray-100 dark:bg-gray-700 p-6 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300">
                <h3 class="text-2xl font-bold mb-3">AI Tumor Detection</h3>
                <p class="text-gray-600 dark:text-gray-300">Instant analysis of medical scan images (DICOM) to assess cancer risk using trained AI models.</p>
            </div>
            <div class="service-card bg-gray-100 dark:bg-gray-700 p-6 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300">
                <h3 class="text-2xl font-bold mb-3">Clinical Pipeline Tooling</h3>
                <p class="text-gray-600 dark:text-gray-300">Command-line tools for clinical researchers to process imaging data and patient datasets efficiently at scale.</p>
            </div>
            <div class="service-card bg-gray-100 dark:bg-gray-700 p-6 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300">
                <h3 class="text-2xl font-bold mb-3">Data Integration & Interoperability</h3>
                <p class="text-gray-600 dark:text-gray-300">Robust support for structured CSV metadata, clinical tagging, and export-ready research formats. Seamlessly integrate with existing hospital systems.</p>
            </div>
        </div>
    </div>
</section>

<section id="continuous-improvement" class="py-16 px-4 sm:px-6 lg:px-8 bg-gray-50 dark:bg-gray-800 rounded-lg shadow-md mt-8">
    <div class="max-w-4xl mx-auto text-center">
        <h2 class="text-4xl font-extrabold mb-6">Advancements</h2>
        <p class="text-lg leading-relaxed mx-auto">At samRad Health Technologies, our mission centers on <strong>precision</strong>&mdash;a quality vividly demonstrated in this radiation beam simulation. The gantry, the rotating arm of a radiation machine, precisely delivers a targeted beam to the tumor, minimizing exposure to healthy tissue. This animation highlights the <strong>crucial role of accurate targeting</strong> in modern cancer treatment and is a core example of the advancements we are working to bring to cancer care.</p>
    </div>
</section>

<section id="certifications" class="py-16 px-4 sm:px-6 lg:px-8 bg-white dark:bg-gray-900 rounded-lg shadow-md mt-8">
    <div class="max-w-4xl mx-auto text-center">
        <h2 class="text-4xl font-extrabold mb-8">Certifications & Research Ethics</h2>
        <ul class="space-y-4 text-left max-w-2xl mx-auto">
            <li class="text-lg">Fully compliant with <strong>HIPAA</strong> data handling protocols to ensure patient data privacy and security.</li>
            <li class="text-lg">Model validation on ethically sourced, anonymized datasets to maintain integrity and prevent bias.</li>
            <li class="text-lg">Strict adherence to <strong>IRB</strong> (Institutional Review Board) and institutional ethics review processes for all research and development.</li>
        </ul>
    </div>
</section>

<section id="quiz" class="py-16 px-4 sm:px-6 lg:px-8 bg-gray-50 dark:bg-gray-800 rounded-lg shadow-md mt-8">
    <div class="max-w-4xl mx-auto text-center">
        <h2 class="text-4xl font-extrabold mb-6">Imaging and Quiz</h2>
        <p class="text-lg leading-relaxed mb-4">Medical imaging&mdash;like MRI, CT, and PET scans&mdash;is often the first step in diagnosing and treating cancer. These tools guide decisions and shape care, but many people don’t fully understand what they are or how they work.</p>

        <p class="text-lg leading-relaxed mb-4">Early detection is especially critical for cancers like breast cancer, prostate cancer, and glioblastoma. Catching these diseases in their earliest stages can significantly improve treatment options, reduce the need for aggressive interventions, and boost survival rates.</p>

        <p class="text-lg leading-relaxed mb-4">At <strong>samRad Health Technologies</strong>, we’re developing software that helps detect tumors directly from medical images (DICOM files)&mdash;making diagnosis faster, earlier, and more accessible. Our goal is to support timely intervention, enable emerging treatment modalities, and ultimately improve patient outcomes.</p>

        <p class="text-lg leading-relaxed mb-4">Being informed can reduce fear, improve communication with your care team, and help you make confident choices.</p>

        <p class="text-lg leading-relaxed mb-4"><strong>Take the quiz to learn the basics and better navigate your health journey.</strong></p>

        <button id="start-quiz-btn" class="mt-8 px-8 py-4 bg-blue-600 text-white font-bold rounded-full shadow-lg hover:bg-blue-700 transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-blue-300">Start Quiz</button>
        <div id="quiz-form" class="mt-4"></div>
        <div id="quiz-result" class="mt-4"></div>
    </div>
</section>

<div id="radiation-animation" class="py-16 px-4 sm:px-6 lg:px-8 bg-white dark:bg-gray-900 rounded-lg shadow-md mt-8">
    <div class="max-w-4xl mx-auto text-center">
        <h2 class="text-4xl font-extrabold mb-6">Radiation Beam Simulation</h2>
        <p class="text-lg leading-relaxed mx-auto">At samRad Health Technologies, our mission centers on <strong>precision</strong>&mdash;a quality vividly demonstrated in this radiation beam simulation. The gantry, the rotating arm of a radiation machine, precisely delivers a targeted beam to the tumor, minimizing exposure to healthy tissue. This animation highlights the <strong>crucial role of accurate targeting</strong> in modern cancer treatment and is a core example of the advancements we are working to bring to cancer care.</p>
    </div>
</div>

            <div id="animation-container-horizontal">
                <div class="gantry-circle">
                    <div class="gantry-head"></div>
                </div>
                <div class="human-body-silhouette" id="human-target">
                    <svg viewBox="0 0 100 200" preserveAspectRatio="xMidYMid meet">
                        <defs>
                            <linearGradient id="humanGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#b0c4de;stop-opacity:1" /> 
                                <stop offset="50%" style="stop-color:#a0b4ce;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#90a4be;stop-opacity:1" /> 
                            </linearGradient>
                        </defs>
                        <path d="M50,20 A15,15 0 1 1 50,50 A15,15 0 1 1 50,20 Z 
                                  M50,50 L50,120 
                                  M50,70 L20,90 M50,70 L80,90 
                                  M50,120 L35,180 M50,120 L65,180"
                            fill="none" stroke="url(#humanGradient)" stroke-width="4"></path>
                    </svg>
                    <div class="tumor"></div>
                </div>
                <div class="beam"></div>
                <div class="patient-table"></div>
            </div>
            <button id="start-animation-btn" style="margin-top: 1.5rem;">Start Treatment Simulation</button>
        </div>
        <section id="contact">
            <h2>Contact Us</h2>
            <p>Email: <a href="mailto:takwirira@proton.me">takwirira@proton.me</a></p>
            <p>GitHub: <a href="https://takwirira25.github.io/samRad-Health-Technologies/" target="_blank" rel="noopener noreferrer">https://takwirira25.github.io/samRad-Health-Technologies/</a></p>
        </section>
    </div>

    <footer>
        <p>&copy; 2025 samRad Health Technologies. All rights reserved.</p>
    </footer>

    <script>
        function throttle(func, limit) {
            let inThrottle;
            return function() {
                const args = arguments;
                const context = this;
                if (!inThrottle) {
                    func.apply(context, args);
                    inThrottle = true;
                    setTimeout(() => inThrottle = false, limit);
                }
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM Content Loaded: Initializing quiz script.');

            const headerTitle = document.querySelector('header h1');
            const navLinks = document.querySelector('nav.nav-links');
            const menuToggle = document.querySelector('.menu-toggle'); 
            const header = document.querySelector('header');

            if (!headerTitle || !navLinks || !header) {
                console.warn('Required header elements for mobile menu or scrolling not found. Some header functionalities might be impacted.');
            }

            if (menuToggle) {
                menuToggle.addEventListener('click', () => {
                    if (navLinks) {
                        navLinks.classList.toggle('active');
                    }
                    menuToggle.classList.toggle('active');
                });
            }

            if (navLinks) {
                navLinks.querySelectorAll('a').forEach(link => {
                    link.addEventListener('click', () => {
                        if (navLinks.classList.contains('active')) { 
                            navLinks.classList.remove('active');
                            if (menuToggle) {
                                menuToggle.classList.remove('active');
                            }
                        }
                    });
                });
            }

            const sections = document.querySelectorAll('section, #radiation-animation');
            const highlightActiveSection = () => {
                let currentActive = null;
                const headerHeight = header ? header.offsetHeight : 0;

                sections.forEach(section => {
                    const sectionTop = section.offsetTop - headerHeight - 60;
                    const sectionBottom = sectionTop + section.offsetHeight;

                    if (window.scrollY >= sectionTop && window.scrollY < sectionBottom) {
                        currentActive = section.id;
                    }
                    section.classList.remove('active-section');
                });

                if (currentActive) {
                    const activeSectionElement = document.getElementById(currentActive);
                    if (activeSectionElement) {
                        activeSectionElement.classList.add('active-section');
                    }
                    if (navLinks) {
                        navLinks.querySelectorAll('a').forEach(link => {
                            link.classList.remove('active');
                            if (link.getAttribute('href') === `#${currentActive}`) {
                                link.classList.add('active');
                            }
                        });
                    }
                }
            };

            window.addEventListener('scroll', throttle(highlightActiveSection, 100));
            highlightActiveSection(); // Call on load to set initial active section

            // --- Quiz Data and Logic ---

            const allQuizData = [
                { question: "What does MRI primarily use to generate images?", options: ["X-rays", "Magnetic fields & radio waves", "Sound waves", "Gamma rays"], answer: 1 },
                { question: "What tracer is commonly used in PET scans?", options: ["Iodine-131", "Technetium-99m", "Fluorodeoxyglucose (FDG)", "Gadolinium"], answer: 2 },
                { question: "CT scans are best for visualizing:", options: ["Soft tissues", "Bone fractures", "Ligaments", "Muscle tears"], answer: 1 },
                { question: "Radiation therapy aims to:", options: ["Cure viral infections", "Kill cancer cells using ionizing radiation", "Deliver chemotherapy", "Visualize tumors"], answer: 1 },
                { question: "Which imaging technique does NOT use ionizing radiation?", options: ["CT", "PET", "MRI", "X-ray"], answer: 2 },
                { question: "PET-CT combines functional imaging with:", options: ["MRI detail", "CT detail", "Ultrasound mapping", "Bone scan"], answer: 1 },
                { question: "Which of the following is a late side effect of radiation therapy?", options: ["Hair loss", "Skin redness", "Fibrosis", "Nausea"], answer: 2 },
                { question: "MRI contrast agents often contain:", options: ["Lead", "Barium", "Gadolinium", "Iodine"], answer: 2 },
                { question: "Which scan is most sensitive for brain soft tissue detail?", options: ["X-ray", "CT", "PET", "MRI"], answer: 3 },
                { question: "Which of the following improves MRI resolution?", options: ["Higher magnetic field strength", "More X-ray dose", "Lower radiofrequency", "Using ultrasound gel"], answer: 0 },
                { question: "What is the primary danger associated with excessive exposure to ionizing radiation?", options: ["Dehydration", "Hearing loss", "Cellular damage and cancer risk", "Muscle atrophy"], answer: 2 },
                { question: "Which imaging modality is commonly used to diagnose gallstones?", options: ["MRI", "CT Scan", "Ultrasound", "X-ray"], answer: 2 },
                { question: "In X-ray imaging, what appears white on the image?", options: ["Air", "Fat", "Water", "Bone"], answer: 3 },
                { question: "What does PACS stand for in radiology?", options: ["Patient Access Control System", "Picture Archiving and Communication System", "Physical Assessment and Clinical Study", "Portable Anatomy Classification System"], answer: 1 },
                { question: "Which type of radiation is used in nuclear medicine scans?", options: ["Alpha particles", "Beta particles", "Gamma rays", "Neutrons"], answer: 2 },
                { question: "What is a common use for a DEXA scan?", options: ["Brain imaging", "Bone density measurement", "Kidney function assessment", "Cardiac imaging"], answer: 1 },
                { question: "Which organ is most sensitive to radiation?", options: ["Skin", "Brain", "Gonads", "Muscles"], answer: 2 },
                { question: "What is an angiogram used to visualize?", options: ["Bones", "Blood vessels", "Muscles", "Nerves"], answer: 1 },
                { question: "What does 'kVp' refer to in X-ray technology?", options: ["Kilovolt-peak", "Kilo-volume particle", "Kinetic velocity pressure", "Kelvin temperature peak"], answer: 0 },
                { question: "What safety precaution is crucial when performing an MRI?", options: ["Wearing lead apron", "Removing all metallic objects", "Using ear protection", "Fasting before the scan"], answer: 1 },
                { question: "What is the primary function of a radiologist?", options: ["Perform surgeries", "Interpret medical images", "Prescribe medication", "Conduct lab tests"], answer: 1 },
                { question: "Which imaging technique uses sound waves?", options: ["CT", "MRI", "X-ray", "Ultrasound"], answer: 3 },
                { question: "What is 'contrast media' used for in imaging?", options: ["To reduce radiation dose", "To enhance visibility of specific tissues or structures", "To speed up the imaging process", "To cool down the scanner"], answer: 1 },
                { question: "Which condition is often diagnosed using a mammogram?", options: ["Heart disease", "Breast cancer", "Lung infection", "Kidney stones"], answer: 1 },
                { question: "What is absorbed dose measured in?", options: ["Sieverts (Sv)", "Grays (Gy)", "Becquerels (Bq)", "Roentgens (R)"], answer: 1 },
                { question: "What is a common application for fluoroscopy?", options: ["Static bone imaging", "Real-time imaging of body structures in motion", "Detailed soft tissue analysis", "Measuring brain activity"], answer: 1 },
                { question: "What does 'ALARA' stand for in radiation safety?", options: ["As Little As Reasonably Achievable", "Always Limit All Radiation Avoidance", "Active Level And Radiation Alert", "Automated Localized Area Radiation Assessment"], answer: 0 },
                { question: "Which imaging technique would be best for evaluating a torn meniscus in the knee?", options: ["X-ray", "CT scan", "MRI", "Ultrasound"], answer: 2 },
                { question: "What is a nuclear stress test used to evaluate?", options: ["Bone strength", "Kidney function", "Heart blood flow", "Brain tumors"], answer: 2 },
                { question: "What does SPECT stand for?", options: ["Single-Photon Emission Computed Tomography", "Specialized Particle Emission CT", "Surface Photonic Emission Camera Technique", "Systematic Proton Emission Capture Test"], answer: 0 },
                { question: "Which type of imaging uses a rotating X-ray tube and detectors?", options: ["MRI", "Ultrasound", "CT scan", "PET scan"], answer: 2 },
                { question: "What is the main advantage of open MRI over closed MRI?", options: ["Higher image quality", "Less claustrophobia for patients", "Faster scan times", "Lower cost"], answer: 1 },
                { question: "What is a common risk of intravenous contrast administration?", options: ["Sunburn", "Allergic reaction", "Hair loss", "Weight gain"], answer: 1 },
                { question: "Which imaging technique is often used for prenatal diagnosis?", options: ["CT scan", "X-ray", "Ultrasound", "PET scan"], answer: 2 },
                { question: "What is the purpose of shielding in radiation therapy?", options: ["To increase radiation dose to the tumor", "To protect healthy tissues from radiation", "To make the patient more comfortable", "To improve image clarity"], answer: 1 },
                { question: "Which body part is most commonly imaged with a barium swallow study?", options: ["Brain", "Lungs", "Esophagus and stomach", "Kidneys"], answer: 2 },
                { question: "What is the typical magnetic field strength of a clinical MRI scanner?", options: ["0.1 Tesla", "1.5 - 3 Tesla", "10 Tesla", "100 Tesla"], answer: 1 },
                { question: "What is the primary application of elastography?", options: ["Measuring blood flow", "Assessing tissue stiffness", "Visualizing bone fractures", "Detecting nerve damage"], answer: 1 },
                { question: "What is the minimum number of X-ray views typically taken for a suspected bone fracture?", options: ["One", "Two (at 90 degrees to each other)", "Three", "Four"], answer: 1 },
                { question: "What is a 'hot spot' on a nuclear medicine scan indicative of?", options: ["Area of reduced metabolic activity", "Area of increased metabolic activity or tracer uptake", "Area of infection only", "Artifact from metal"], answer: 1 },
                { question: "Which type of imaging provides real-time functional information about metabolism?", options: ["CT", "MRI", "PET", "X-ray"], answer: 2 },
                { question: "What is used to produce radioisotopes for medical imaging?", options: ["X-ray tube", "Particle accelerator (cyclotron)", "Large magnet", "Ultrasound transducer"], answer: 1 },
                { question: "Which contrast agent is commonly used for CT scans?", options: ["Gadolinium", "Barium sulfate", "Iodinated contrast", "Saline"], answer: 2 },
                { question: "What is a 'slice' in the context of CT or MRI imaging?", options: ["A portion of a bone", "A thin cross-sectional image of the body", "A type of contrast agent", "A measurement of radiation dose"], answer: 1 },
                { question: "What is the main concern when using X-rays on pregnant patients?", options: ["Claustrophobia", "Risk of harm to the fetus", "Discomfort for the mother", "High cost"], answer: 1 },
                { question: "What does 'mCi' stand for in nuclear medicine?", options: ["Microcurie", "Millicurie", "Mega-coulomb", "Meter-calorie"], answer: 1 },
                { question: "Which imaging technique can assess blood flow and organ perfusion?", options: ["Standard X-ray", "Fluoroscopy", "Nuclear medicine scans", "Basic ultrasound"], answer: 2 },
                { question: "What is the primary use of a cardiac MRI?", options: ["To visualize lung infections", "To assess heart structure and function", "To detect bone tumors", "To image the digestive tract"], answer: 1 },
                { question: "What is the typical effect of radiation on fast-dividing cells (like cancer cells)?", options: ["They become stronger", "They are more susceptible to radiation damage", "They stop dividing temporarily", "They absorb less radiation"], answer: 1 },
                { question: "Which type of biopsy is often guided by imaging (e.g., ultrasound or CT)?", options: ["Surgical biopsy", "Needle biopsy", "Punch biopsy", "Excisional biopsy"], answer: 1 },
                { question: "What is the purpose of a lead apron in X-ray procedures?", options: ["To keep the patient warm", "To protect the patient and staff from scattered radiation", "To enhance X-ray penetration", "To provide comfort"], answer: 1 },
                { question: "Which imaging modality is commonly used for evaluating breast tissue density?", options: ["CT Scan", "Ultrasound", "Mammography", "MRI"], answer: 2 },
                { question: "What is 'radiopaque' referring to in medical imaging?", options: ["Transparent to X-rays", "Opaque to X-rays", "Emitting sound waves", "Conducting electricity"], answer: 1 },
                { question: "What type of energy is used in PET scans?", options: ["Radio waves", "Magnetic fields", "Gamma rays from positron annihilation", "Infrared light"], answer: 2 },
                { question: "Which of these is a common indication for a bone scan?", options: ["Fractures, infections, and tumors", "Muscle strains", "Ligament tears", "Brain bleeds"], answer: 0 },
                { question: "What does 'attenuation' mean in the context of X-rays?", options: ["Increasing X-ray intensity", "The reduction of the X-ray beam's intensity as it passes through matter", "Reflection of X-rays", "Changing the X-ray frequency"], answer: 1 },
                { question: "Which element is crucial for the strong magnetic field in an MRI scanner?", options: ["Copper", "Aluminum", "Niobium-titanium (superconductor)", "Iron"], answer: 2 },
                { question: "What is a 'hot lab' in nuclear medicine?", options: ["A lab for heating samples", "A designated area for handling radioactive materials", "A lab with high temperatures", "A research lab for new technologies"], answer: 1 },
                { question: "What is a common side effect of radiation therapy on the skin?", options: ["Increased pigmentation", "Redness and irritation (radiation dermatitis)", "Cooling sensation", "Numbness"], answer: 1 },
                { question: "Which imaging technique is most suitable for dynamic studies of joints and tendons?", options: ["X-ray", "CT scan", "MRI", "Ultrasound"], answer: 3 },
                { question: "What does 'dose equivalent' refer to in radiation safety?", options: ["The total energy absorbed by tissue", "A measure of the biological effect of radiation", "The rate of radiation exposure", "The amount of radioactive material"], answer: 1 },
                { question: "What is the primary advantage of 3D rendering from CT or MRI data?", options: ["Faster scan times", "Better visualization of complex anatomical relationships", "Reduced radiation dose", "Lower cost"], answer: 1 },
                { question: "Which of the following is NOT a component of a typical X-ray tube?", options: ["Anode", "Cathode", "Filament", "Transducer"], answer: 3 },
                { question: "What is the role of a dosimetrist in radiation oncology?", options: ["To interpret patient images", "To calibrate imaging machines", "To plan and calculate radiation doses for patients", "To perform patient interviews"], answer: 2 },
                { question: "Which imaging modality is non-ionizing and can be used repeatedly for monitoring?", options: ["CT", "PET", "Ultrasound", "X-ray"], answer: 2 },
                { question: "What is a 'tracer' in nuclear medicine?", options: ["A device for tracking patient movement", "A radioactive substance used to image and assess organ function", "A contrast agent for MRI", "A type of X-ray detector"], answer: 1 },
                { question: "What condition might be evaluated with a CT angiogram?", options: ["Bone density", "Blood clots or blockages in arteries", "Muscle tears", "Brain tumors"], answer: 1 },
                { question: "What is the typical patient preparation for an abdominal ultrasound?", options: ["Full bladder", "Empty stomach (fasting)", "Drinking barium solution", "Intravenous contrast injection"], answer: 1 },
                { question: "What is 'radiation recall' syndrome?", options: ["A patient's memory of their radiation therapy", "A skin reaction that occurs in a previously irradiated field after chemotherapy", "The process of recalling scattered radiation", "A method to re-energize radiation beams"], answer: 1 },
                { question: "Which of the following describes the principle of MRI signal generation?", options: ["Absorption of X-rays by dense tissue", "Reflection of sound waves from interfaces", "Excitation of hydrogen protons by radiofrequency pulses in a strong magnetic field", "Emission of gamma rays from radioactive tracers"], answer: 2 },
                { question: "What does 'collimation' do in X-ray imaging?", options: ["Increases the X-ray dose", "Narrows the X-ray beam to reduce scatter radiation", "Heats the X-ray tube", "Controls the image brightness"], answer: 1 },
                { question: "Which substance is used in a barium enema for colon imaging?", options: ["Iodinated contrast", "Saline", "Air", "Barium sulfate"], answer: 3 },
                { question: "What is the typical duration of a routine MRI scan?", options: ["A few seconds", "5-10 minutes", "20-60 minutes", "Several hours"], answer: 2 },
                { question: "Which imaging technique is often used to diagnose deep vein thrombosis (DVT)?", options: ["X-ray", "CT scan", "Doppler Ultrasound", "PET scan"], answer: 2 },
                { question: "What is a 'hot nodule' on a thyroid scan indicative of?", options: ["A non-functioning nodule", "An overactive nodule", "A cancerous nodule", "An artifact"], answer: 1 },
                { question: "Which imaging modality can be affected by patient motion more significantly?", options: ["X-ray", "CT scan", "MRI", "Ultrasound"], answer: 2 },
                { question: "What is the primary function of the technologist in radiology?", options: ["Interpreting images", "Operating imaging equipment and positioning patients", "Prescribing treatments", "Performing surgery"], answer: 1 },
                { question: "What does 'Hounsfield Units' refer to?", options: ["Units of magnetic field strength", "Units of sound wave frequency", "Units of tissue density in CT scans", "Units of radiation exposure"], answer: 2 },
                { question: "Which type of radiation is commonly used for external beam radiation therapy?", options: ["Alpha particles", "Beta particles", "X-rays and gamma rays", "Microwaves"], answer: 2 },
                { question: "What is a common application of interventional radiology?", options: ["Performing open heart surgery", "Minimally invasive procedures guided by imaging", "Designing radiation therapy plans", "Analyzing blood samples"], answer: 1 },
                { question: "Which imaging technique is considered the gold standard for evaluating traumatic brain injury (TBI) acutely?", options: ["MRI", "PET", "CT scan", "Ultrasound"], answer: 2 },
                { question: "What is the main concern with using MRI in patients with pacemakers?", options: ["Image quality degradation", "Interference with pacemaker function, potentially life-threatening", "Allergic reaction to contrast", "Claustrophobia"], answer: 1 },
                { question: "What does 'fractionation' mean in radiation therapy?", options: ["Delivering the total radiation dose in multiple small doses over time", "Dividing the tumor into fractions", "Reducing the total radiation dose", "Increasing the radiation dose to a specific area"], answer: 0 },
                { question: "Which medical specialty focuses on the diagnostic interpretation of medical images?", options: ["Oncology", "Cardiology", "Radiology", "Pathology"], answer: 2 },
                { question: "What is the purpose of iodine in contrast agents for CT scans?", options: ["To make the agent glow", "To absorb X-rays and enhance tissue visibility", "To reduce patient discomfort", "To increase the scan speed"], answer: 1 },
                { question: "Which imaging technique is most effective at showing fluid collections in the body?", options: ["X-ray", "CT Scan", "MRI", "Mammography"], answer: 2 },
                { question: "What is 'Brachytherapy'?", options: ["A type of external radiation therapy", "Radiation therapy involving placing radioactive sources directly into or near the tumor", "A diagnostic imaging technique", "A form of chemotherapy"], answer: 1 },
                { question: "What is 'MR Angiography' (MRA) used for?", options: ["Imaging bones", "Visualizing blood vessels using MRI", "Assessing lung function", "Measuring brain activity"], answer: 1 },
                { question: "What is the primary use of a dental X-ray?", options: ["To image the brain", "To assess bone density", "To detect cavities and dental problems", "To visualize soft tissues"], answer: 2 },
                { question: "Which of the following describes a 'cold spot' on a nuclear medicine scan?", options: ["An area of increased tracer uptake", "An area of reduced or absent tracer uptake", "An artifact from motion", "A region with high metabolic activity"], answer: 1 },
                { question: "What is the maximum permissible dose (MPD) concept related to?", options: ["Therapeutic radiation doses", "Occupational radiation exposure limits for workers", "Patient radiation safety during imaging", "Dose to a tumor"], answer: 1 },
                { question: "What does the 'pitch' refer to in helical CT scanning?", options: ["The angle of the X-ray tube", "The speed of the patient table movement relative to the beam width", "The brightness of the image", "The size of the detector elements"], answer: 1 },
                { question: "What is the role of a physicist in a radiation oncology department?", options: ["Administering chemotherapy", "Maintaining imaging equipment", "Ensuring accurate and safe radiation delivery", "Performing patient consultations"], answer: 2 },
                { question: "Which type of ultrasound is used to create real-time moving images?", options: ["A-mode", "B-mode", "M-mode", "Static mode"], answer: 1 },
                { question: "What is a 'gantry' in CT or radiation therapy?", options: ["The patient bed", "The rotating ring that houses the X-ray tube and detectors", "The control console", "The image display screen"], answer: 1 },
                { question: "What are 'T1-weighted' and 'T2-weighted' images in MRI used to differentiate?", options: ["Bone vs. muscle", "Air vs. fluid", "Different tissue types and pathologies", "Static vs. dynamic structures"], answer: 2 },
                { question: "Which imaging technique is often used to guide biopsies of organs like the liver or kidney?", options: ["Plain X-ray", "Mammography", "Ultrasound or CT", "DEXA scan"], answer: 2 },
                { question: "What does 'radiation sickness' refer to?", options: ["A fear of radiation", "Symptoms that occur after exposure to high doses of radiation", "A type of cancer caused by radiation", "A skin rash from radiation therapy"], answer: 1 },
                { question: "Which contrast agent is typically given orally for gastrointestinal studies?", options: ["Gadolinium", "Iodinated contrast", "Barium sulfate", "Saline"], answer: 2 },
                { question: "What is the concept of 'dose-response' in radiation biology?", options: ["The speed of radiation absorption", "A relationship between radiation dose and the observed biological effect", "The patient's response to imaging", "The accuracy of image interpretation"], answer: 1 }
            ];

            let currentQuizQuestions = []; 

            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }

            const startQuizBtn = document.getElementById("start-quiz-btn");
            const quizForm = document.getElementById("quiz-form");
            const quizResult = document.getElementById("quiz-result");

            console.log('startQuizBtn element:', startQuizBtn);
            console.log('quizForm element:', quizForm);
            console.log('quizResult element:', quizResult);

            if (!startQuizBtn) {
                console.error("Initialization Error: HTML element with ID 'start-quiz-btn' not found. Quiz functionality will not be available.");
                return;
            }
            if (!quizForm) {
                console.error("Initialization Error: HTML element with ID 'quiz-form' not found. Quiz questions cannot be rendered.");
                return;
            }
            if (!quizResult) {
                console.error("Initialization Error: HTML element with ID 'quiz-result' not found. Quiz results cannot be displayed.");
                return;
            }

            function getFeedback(score, total) {
                const percent = (score / total) * 100;
                if (percent === 100) return "Outstanding! You're a radiology genius!";
                if (percent >= 80) return "Great job! You really know your imaging.";
                if (percent >= 50) return "Nice effort! A bit more study and you'll master this.";
                return "Keep learning — knowledge saves lives!";
            }

            function getFeedbackColor(percent) {
                if (percent >= 80) return "green";
                else if (percent >= 50) return "orange";
                else return "red";
            }

            function saveScore(score, total) {
                const entry = { score, total, timestamp: new Date().toISOString() };
                const scores = JSON.parse(localStorage.getItem("quizScores") || "[]");
                scores.push(entry);
                localStorage.setItem("quizScores", JSON.stringify(scores));
            }

            function renderQuestion(index, answers, next) {
                if (!quizForm) {
                    console.error("Render Error: Quiz form element is missing, cannot render question.");
                    return;
                }

                quizForm.innerHTML = ""; 

                const q = currentQuizQuestions[index];
                if (!q) {
                    console.warn("Render Warning: Question not found at index", index, ". Finishing quiz.");
                    finishQuiz(answers);
                    return;
                }

                const qElem = document.createElement("p");
                qElem.textContent = `${index + 1}. ${q.question}`;
                quizForm.appendChild(qElem);

                q.options.forEach((opt, i) => {
                    const label = document.createElement("label");
                    label.className = "quiz-option-label"; 
                    const input = document.createElement("input");
                    input.type = "radio";
                    input.name = `q${index}`; 
                    input.value = i;
                    input.id = `q${index}-option${i}`; 

                    label.appendChild(input);
                    label.append(` ${opt}`); 
                    quizForm.appendChild(label);

                    input.addEventListener("change", () => {
                        answers[index] = parseInt(input.value);
                        setTimeout(next, 300); 
                    });
                });
            }

            function runQuiz() {
                console.log('runQuiz function called: Starting a new quiz.');
                if (!quizForm || !startQuizBtn || !quizResult) {
                    console.error("Run Quiz Error: Cannot start quiz, one or more essential HTML elements are missing.");
                    return;
                }

                const shuffledQuestions = shuffleArray([...allQuizData]); 
                currentQuizQuestions = shuffledQuestions.slice(0, 5); 
                console.log('Selected 5 random questions for this quiz:', currentQuizQuestions.map(q => q.question));

                let currentIndex = 0;
                const answers = {}; 

                quizForm.style.display = "block";
                quizResult.innerHTML = ""; 
                startQuizBtn.style.display = "none"; 

                function nextQuestion() {
                    currentIndex++;
                    if (currentIndex < currentQuizQuestions.length) {
                        renderQuestion(currentIndex, answers, nextQuestion);
                    } else {
                        finishQuiz(answers); 
                    }
                }

                renderQuestion(currentIndex, answers, nextQuestion); 
            }

            function finishQuiz(answers) {
                if (!quizForm || !quizResult || !startQuizBtn) {
                    console.error("Finish Quiz Error: Cannot complete quiz, one or more essential HTML elements are missing.");
                    return;
                }

                let score = 0;
                currentQuizQuestions.forEach((q, idx) => {
                    if (answers.hasOwnProperty(idx) && answers[idx] === q.answer) {
                        score++;
                    }
                });

                const total = currentQuizQuestions.length;
                const percent = (total > 0) ? (score / total) * 100 : 0; 
                const feedback = getFeedback(score, total);
                const color = getFeedbackColor(percent);

                saveScore(score, total); 

                quizForm.style.display = "none";
                startQuizBtn.style.display = "inline-block";
                startQuizBtn.textContent = "Retake Quiz"; 

                quizResult.innerHTML = `
                    <p>You scored **${score}** out of **${total}**.</p>
                    <p style="color:${color}; font-weight: bold;">${feedback}</p>
                    <div class="quiz-actions">
                        <button id="exit-quiz-btn" class="quiz-btn">Exit Quiz</button>
                        <button id="show-stats-btn" class="quiz-btn">Show Highest Score</button>
                        <button id="reset-stats-btn" class="quiz-btn">Reset Stats</button>
                    </div>
                `;

                const exitQuizBtn = document.getElementById("exit-quiz-btn");
                if (exitQuizBtn) {
                    exitQuizBtn.addEventListener("click", () => {
                        quizResult.innerHTML = ""; 
                        startQuizBtn.textContent = "Start Quiz"; 
                        startQuizBtn.style.display = "inline-block"; 
                    });
                }

                const showStatsBtn = document.getElementById("show-stats-btn");
                if (showStatsBtn) {
                    showStatsBtn.addEventListener("click", () => {
                        const scores = JSON.parse(localStorage.getItem("quizScores") || "[]");
                        let statsMessage = document.createElement("p");
                        statsMessage.classList.add('stats-message'); 

                        if (scores.length === 0) {
                            statsMessage.textContent = "No scores recorded yet.";
                            statsMessage.style.color = "gray";
                        } else {
                            const maxScoreEntry = scores.reduce((prev, current) => (prev.score > current.score ? prev : current), {score: 0, total: 5});
                            const percentMax = (maxScoreEntry.score / maxScoreEntry.total) * 100;
                            statsMessage.textContent = `Your Highest Score so far is: **${maxScoreEntry.score}** out of ${maxScoreEntry.total}.`;
                            statsMessage.style.color = getFeedbackColor(percentMax);
                        }

                        const existingStatsMsg = quizResult.querySelector('.stats-message');
                        if (existingStatsMsg) {
                            existingStatsMsg.remove();
                        }
                        quizResult.appendChild(statsMessage);
                        showStatsBtn.disabled = true; 
                    });
                }

                const resetStatsBtn = document.getElementById("reset-stats-btn");
                if (resetStatsBtn) {
                    resetStatsBtn.addEventListener("click", () => {
                        localStorage.removeItem("quizScores"); 

                        const existingStatsMsg = quizResult.querySelector('.stats-message');
                        if (existingStatsMsg) {
                            existingStatsMsg.remove();
                        }

                        const confirmMsg = document.createElement("p");
                        confirmMsg.textContent = "Stats reset successfully.";
                        confirmMsg.style.color = "green";
                        confirmMsg.classList.add('stats-confirmation-message'); 
                        quizResult.appendChild(confirmMsg);

                        resetStatsBtn.disabled = true;
                        if (showStatsBtn) {
                            showStatsBtn.disabled = false; 
                        }

                        setTimeout(() => {
                            confirmMsg.remove(); 
                            resetStatsBtn.disabled = false; 
                        }, 3000);
                    });
                }
            }

            startQuizBtn.addEventListener("click", runQuiz);
            console.log('Event listener attached to startQuizBtn.');

            if (quizForm.style.display !== "block") { 
                startQuizBtn.textContent = "Start Quiz";
            }


// --- Radiation Animation Logic (Polished and Final Version) ---

// --- Core Animation Elements Selection ---
const gantryCircle = document.querySelector('.gantry-circle');
const gantryHead = document.querySelector('.gantry-head');
const beam = document.querySelector('.beam');
const tumor = document.querySelector('.tumor');
const startSimulationBtn = document.getElementById('start-animation-btn');

// --- Animation Configuration Constants ---
// Defines the radius for the gantry's rotation within its container
const GANTRY = {
    ROTATION_RADIUS: 120, // Half of .gantry-circle width/height (240px / 2)
    HEAD_OFFSET: 17.5     // Half width/height of .gantry-head (35px / 2)
};

// Defines properties for the tumor's initial size and how it shrinks
const TUMOR = {
    INITIAL_SIZE: 20,       // Initial visual size in pixels (width and height)
    MIN_SIZE_FACTOR: 0.0,   // Tumor shrinks to 0% of its initial size (fully destroyed)
    // Adjusted to ensure complete destruction over 4 angles (4 * 0.25 = 1.0)
    DOSE_REDUCTION_FACTOR: 0.25
};

// Defines timing and performance parameters for the animation
const ANIMATION = {
    FRAME_RATE: 60,                        // Frames per second for smooth animation (higher = smoother)
    ROTATION_DURATION_PER_ANGLE_MS: 1000,  // Time for the gantry to rotate to each treatment angle
    BEAM_DURATION_MS: 500                  // How long the radiation beam is visible during a "shot"
};

// Specific angles (in degrees) from which radiation will be delivered
// A real system would have many more, carefully chosen angles.
const TREATMENT_ANGLES = [0, 90, 180, 270]; // Four angles for complete destruction with 0.25 dose factor

// --- Animation State Variables ---
let animationIntervalId = null;   // Stores the ID of the current setInterval for rotation
let currentTumorScale = 1.0;      // Tracks the tumor's current visual scale (1.0 = initial size)
let isSimulationActive = false;   // Flag to manage whether a simulation is currently running

/**
 * Calculates the gantry head's exact CSS `top` and `left` positions based on its rotation angle.
 * This ensures the head stays on the edge of the rotating gantry circle.
 * @param {number} angle - The current rotation angle in degrees.
 * @returns {{left: string, top: string}} An object containing CSS `left` and `top` style values.
 */
function calculateGantryHeadPosition(angle) {
    // Convert angle to radians for trigonometric functions
    const angleRad = angle * Math.PI / 180;
    // Calculate x and y coordinates on the circle
    const headX = GANTRY.ROTATION_RADIUS * Math.sin(angleRad);
    const headY = -GANTRY.ROTATION_RADIUS * Math.cos(angleRad); // Negative because CSS Y-axis is inverted

    // Return calculated positions, accounting for the gantry head's own size offset
    return {
        left: `calc(50% + ${headX}px - ${GANTRY.HEAD_OFFSET}px)`,
        top: `calc(50% + ${headY}px - ${GANTRY.HEAD_OFFSET}px)`
    };
}

/**
 * Resets all animation elements and state variables to their initial conditions.
 * This prepares the simulation for a fresh start or stops an ongoing one.
 */
function resetSimulation() {
    console.log('Resetting simulation...');
    clearInterval(animationIntervalId); // Stop any ongoing rotation animation
    animationIntervalId = null;

    currentTumorScale = 1.0;
    isSimulationActive = false;

    // Reset Gantry circle to 0 degrees
    gantryCircle.style.transform = `translate(-50%, -50%) rotate(0deg)`;
    // Reset Gantry head to its initial (top-center) position corresponding to 0 degrees
    const initialHeadPos = calculateGantryHeadPosition(0);
    gantryHead.style.left = initialHeadPos.left;
    gantryHead.style.top = initialHeadPos.top;

    // Reset Beam to hidden state
    beam.style.width = '0';
    beam.style.opacity = '0';
    beam.classList.remove('firing'); // Remove any pulsing animation class
    // Re-enable transitions for smoother future beam appearance
    beam.style.transition = 'width 0.3s ease-out, opacity 0.3s ease-out';

    // Reset Tumor to original size and opacity
    tumor.style.transform = `translate(-50%, -50%) scale(1)`;
    tumor.style.opacity = '1';
    tumor.classList.remove('glowing'); // Remove glow effect
    // Re-enable transitions for smoother future tumor shrinkage
    tumor.style.transition = 'transform 0.5s ease-out, opacity 0.5s ease-out';

    // Reset Start Button state
    startSimulationBtn.disabled = false;
    startSimulationBtn.textContent = 'Start Treatment Simulation'; // Always reset to "Start"
}

/**
 * Animates the gantry's rotation to a specific `targetAngle` and then simulates
 * the firing of the radiation beam, causing the tumor to shrink.
 * @param {number} targetAngle - The final angle (in degrees) the gantry should rotate to for treatment.
 * @returns {Promise<void>} A Promise that resolves once the beam has fired and faded,
 * allowing sequential treatment steps.
 */
function animateAndDeliverRadiation(targetAngle) {
    return new Promise(resolve => {
        // Get the current rotation angle of the gantry
        const startAngleString = gantryCircle.style.transform.split('rotate(')[1];
        const startAngle = parseFloat(startAngleString?.split('deg')[0]) || 0;
        const angleDiff = targetAngle - startAngle;

        const totalFrames = (ANIMATION.ROTATION_DURATION_PER_ANGLE_MS / 1000) * ANIMATION.FRAME_RATE;
        const angleIncrement = angleDiff / totalFrames;

        let currentFrame = 0;

        // Temporarily disable CSS transitions on gantry elements for precise frame-by-frame control
        gantryCircle.style.transition = 'none';
        gantryHead.style.transition = 'none';

        animationIntervalId = setInterval(() => {
            currentFrame++;
            // Calculate the current angle during the rotation animation
            const currentRotationAngle = startAngle + angleIncrement * currentFrame;

            // Update gantry circle's rotation
            gantryCircle.style.transform = `translate(-50%, -50%) rotate(${currentRotationAngle}deg)`;

            // Update gantry head's position based on the current angle
            const headPos = calculateGantryHeadPosition(currentRotationAngle);
            gantryHead.style.left = headPos.left;
            gantryHead.style.top = headPos.top;

            // Check if rotation animation is complete
            if (currentFrame >= totalFrames) {
                clearInterval(animationIntervalId); // Stop the rotation interval
                animationIntervalId = null; // Clear the interval ID

                // --- Beam Firing Sequence ---

                // Calculate beam origin at the center of the gantry head
                const beamOriginX = parseFloat(gantryHead.style.left) + GANTRY.HEAD_OFFSET;
                const beamOriginY = parseFloat(gantryHead.style.top) + GANTRY.HEAD_OFFSET;

                // Position and orient the beam
                beam.style.transformOrigin = `0% 50%`; // Beam starts from its left edge
                beam.style.left = `${beamOriginX}px`;
                beam.style.top = `${beamOriginY}px`;
                // The beam always points towards the center of the animation container (tumor)
                beam.style.transform = `translateY(-50%) rotate(${targetAngle}deg)`;

                // Add transitions back for beam visibility changes
                beam.style.transition = 'width 0.1s ease-out, opacity 0.1s ease-out, transform 0.1s ease-out';

                // Apply beam styling for "firing" state
                beam.style.background = 'linear-gradient(to right, rgba(255, 0, 0, 0.95), rgba(255, 0, 0, 1))'; // Red color
                beam.style.boxShadow = '0 0 50px rgba(255, 0, 0, 1.2)'; // Red glow
                beam.style.width = `${GANTRY.ROTATION_RADIUS + (TUMOR.INITIAL_SIZE / 2)}px`; // Extend beam to tumor center
                beam.style.opacity = '1';
                beam.classList.add('firing'); // Add class for pulsing effect (if defined in CSS)
                tumor.classList.add('glowing'); // Make tumor glow when hit

                console.log(`Beam fired at ${targetAngle} degrees.`);

                // --- Tumor Shrinkage ---
                // Calculate new tumor scale, ensuring it doesn't go below the minimum
                currentTumorScale = Math.max(TUMOR.MIN_SIZE_FACTOR, currentTumorScale - TUMOR.DOSE_REDUCTION_FACTOR);
                // Apply shrinkage with CSS transitions for smooth visual effect
                tumor.style.transition = 'transform 0.5s ease-out, opacity 0.5s ease-out';
                tumor.style.transform = `translate(-50%, -50%) scale(${currentTumorScale})`;
                // Adjust tumor opacity as it shrinks, fading it out completely at MIN_SIZE_FACTOR
                tumor.style.opacity = currentTumorScale === TUMOR.MIN_SIZE_FACTOR ? '0' : (0.5 + (currentTumorScale * 0.5));


                setTimeout(() => {
                    // Hide beam after its duration
                    beam.style.width = '0';
                    beam.style.opacity = '0';
                    beam.classList.remove('firing'); // Remove pulsing class
                    tumor.classList.remove('glowing'); // Stop tumor glow
                    resolve(); // Resolve the promise, indicating this step is complete
                }, ANIMATION.BEAM_DURATION_MS);
            }
        }, 1000 / ANIMATION.FRAME_RATE);
    });
}

/**
 * Initiates the full radiation treatment simulation sequence.
 * This function uses `async/await` to ensure each treatment step (rotation + beam)
 * completes before the next one begins.
 */
async function startRadiationSimulation() {
    // If a simulation is already active, calling it again will reset it
    // and then start a new one.
    if (isSimulationActive) {
        resetSimulation(); // Reset current active simulation
    }

    isSimulationActive = true; // Set flag to true to indicate simulation is running
    startSimulationBtn.disabled = true; // Disable button during simulation
    startSimulationBtn.textContent = 'Treating...'; // Update button text

    // Loop through each predefined treatment angle
    for (let i = 0; i < TREATMENT_ANGLES.length; i++) {
        // Await each call to `animateAndDeliverRadiation` to ensure sequential execution
        // The gantry will rotate to the angle, fire, and hide the beam before moving to the next.
        await animateAndDeliverRadiation(TREATMENT_ANGLES[i]);
    }

    // --- Simulation Completion ---
    isSimulationActive = false; // Mark simulation as complete
    startSimulationBtn.disabled = false; // Re-enable the button

    // Show "Treatment Complete!" message for 2 seconds
    startSimulationBtn.textContent = 'Treatment Complete!';
    tumor.style.opacity = '0'; // Ensure tumor is completely invisible if not already

    setTimeout(() => {
        // After 2 seconds, revert button text to "Start Treatment Simulation"
        startSimulationBtn.textContent = 'Start Treatment Simulation';
        console.log('Radiation treatment simulation completed. Tumor fully destroyed.');
    }, 2000); // 2000 milliseconds = 2 seconds
}

// --- Event Listener ---
// Attach the main simulation function to the click event of the start button
startSimulationBtn.addEventListener('click', startRadiationSimulation);

// --- Initial Setup ---
// Ensure the simulation is in a reset state when the page first loads.
// If you have other DOMContentLoaded listeners, consider combining them.
document.addEventListener('DOMContentLoaded', resetSimulation);



            // Optional: Recalculate beam on window resize to keep it aligned
            window.addEventListener('resize', throttle(() => {
                updateBeam(currentAngle);
            }, 200)); 
        });
    </script>
</body>
</html>
