<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>samRad Health Technologies</title>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;600;700&display=Cursive" rel="stylesheet">
    <meta name="description" content="Visionary projects to advance cancer detection mechanisms">
    <meta name="keywords" content="samrad, health, technologies">
    <meta name="robots" content="index, follow">

    <style>
        /* Base Styles */
        body {
            font-family: 'Segoe UI', sans-serif;
            margin: 0;
            background: linear-gradient(to right, #f8fbff, #e9f0f8); /* Softer, lighter gradient */
            color: #333;
            line-height: 1.6;
            scroll-behavior: smooth;
        }

        /* Header */
        header {
            background: linear-gradient(to right, #001f3f, #003366); /* Deeper blue gradient */
            color: #fff;
            padding: 0.3rem 1.5rem; /* Constant, minimal padding */
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            position: sticky;
            top: 0;
            z-index: 1000;
            display: flex;
            flex-direction: column; /* Stacks title and nav vertically for desktop */
            align-items: center;
            text-align: center;
        }

        header h1 {
            margin: 0; /* Remove default margin to reduce vertical space */
            font-size: 2.0rem; /* Fixed, minimal font size for constant header */
            color: #c9e6ff;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3),
                         4px 4px 8px rgba(0,0,0,0.2),
                         6px 6px 12px rgba(0,0,0,0.1);
            letter-spacing: 0.05rem;
            line-height: 1.2; /* Adjust line height to reduce space above/below text */
            white-space: nowrap; /* Keep the title on one line */
        }

        /* Navigation (Desktop) */
        nav.nav-links {
            margin-top: 0.5rem; /* Minimal margin from title */
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            flex-wrap: wrap;
        }

        nav a {
            color: #e0f2f7;
            text-decoration: none;
            font-weight: 600;
            position: relative;
            white-space: nowrap;
            padding-bottom: 5px;
            transition: color 0.2s ease;
            font-size: 0.95rem;
        }

        nav a::after {
            content: '';
            display: block;
            width: 0;
            height: 2px;
            background: #89cff0;
            transition: width 0.2s ease-in-out;
            position: absolute;
            bottom: 0;
            left: 0;
        }

        nav a:hover,
        nav a.active {
            color: #fff;
        }

        nav a:hover::after,
        nav a.active::after {
            width: 100%;
        }

        /* Mobile Menu Toggle (hidden by default on desktop) */
        .menu-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 1.8rem;
            color: #fff;
            cursor: pointer;
            margin-top: 0.5rem;
            padding: 5px 10px;
            border-radius: 5px;
            transition: background-color 0.2s ease, margin-top 0.2s ease-out;
        }

        /* Main Container */
        .container {
            padding: 3rem 6vw;
            max-width: 1300px;
            margin: 0 auto;
            animation: fadeIn 1.2s ease-out;
        }

        /* Headings */
        h1, h2 {
            color: #001f3f;
            margin-bottom: 1.2rem;
        }

        h2 {
            color: #001f3f;
            font-size: 2rem;
            border-bottom: 2px solid #d0e0f0;
            padding-bottom: 0.7rem;
            position: relative;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2),
                         2px 2px 4px rgba(0,0,0,0.15);
        }

        h2::before {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 50px;
            height: 3px;
            background: #007bff;
        }

        /* Sections */
        section {
            margin-bottom: 3.5rem;
            padding: 2rem;
            border-radius: 12px;
            background-color: #ffffff;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            transition: all 0.4s ease;
        }

        section.active-section {
            background: #eef7ff;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        /* Services Grid */
        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .service-card {
            background: #ffffff;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            border-left: 6px solid #007bff;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .service-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.2);
        }

        .service-card h3 {
            margin-top: 0;
            color: #001f3f;
            font-size: 1.4rem;
            margin-bottom: 0.8rem;
        }

        .service-card p {
            color: #555;
        }

        /* Buttons */
        button {
            background-color: #007bff;
            color: #fff;
            border: none;
            padding: 0.9rem 1.8rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.05rem;
            font-weight: 600;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            display: inline-block;
            margin-right: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        button:hover {
            background-color: #0056b3;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        button:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Quiz Specific Styles */
        #quiz-form label {
            display: block;
            margin-bottom: 0.8rem;
            cursor: pointer;
            font-size: 1.05rem;
            color: #444;
            transition: color 0.2s ease, background-color 0.2s ease, border-color 0.2s ease;
            padding: 0.7rem 1rem; /* Added padding for easier click target */
            border-radius: 8px; /* Slightly rounded corners */
            background-color: #f9f9f9; /* Light background for options */
            border: 1px solid #eee; /* Subtle border */
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); /* Subtle shadow */
        }

        #quiz-form label:hover {
            color: #007bff;
            background-color: #eef7ff; /* Lighter background on hover */
            border-color: #cce0f0;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        #quiz-form label input[type="radio"] {
            margin-right: 0.8rem;
            transform: scale(1.2);
            /* Make radio button itself less prominent for click target, label handles it */
            pointer-events: none; /* Disable direct clicks on radio, let label handle it */
        }
        /* Style for checked radio button labels */
        #quiz-form label input[type="radio"]:checked + span {
            font-weight: 700;
            color: #001f3f;
        }


        #quiz-result p {
            margin-bottom: 0.8rem;
            font-size: 1.1rem;
        }

        #highest-score-display {
            margin-top: 1.5rem;
            font-size: 1.2rem;
            font-weight: bold;
            color: #0056b3;
        }

        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            header {
                padding: 0.3rem 1rem; /* Reduced padding for mobile */
            }

            header h1 {
                font-size: 1.5rem; /* Smaller font for mobile header */
                white-space: nowrap; /* Ensure it stays on one line */
                overflow: hidden; /* Hide overflow if it somehow goes beyond */
                text-overflow: ellipsis; /* Add ellipsis if hidden */
            }

            nav.nav-links {
                /* No flex-direction: column; to keep links horizontal */
                gap: 0.3rem; /* Reduced gap between links */
                margin-top: 0.3rem; /* Reduced margin from title */
                justify-content: space-around; /* Distribute space more evenly */
                flex-wrap: wrap; /* Allow wrapping if absolutely necessary, but try to prevent */
            }

            nav a {
                font-size: 0.75rem; /* Even smaller font for nav links */
                padding: 3px 0.1rem; /* Reduced vertical and horizontal padding for tighter fit */
            }

            .container {
                padding: 2rem 4vw; /* Slightly less padding on sides for mobile */
            }

            h2 {
                font-size: 1.7rem; /* Smaller headings on mobile */
                padding-bottom: 0.5rem;
            }

            section {
                padding: 1.5rem; /* Reduced section padding */
            }

            .service-card {
                padding: 1.5rem; /* Reduced service card padding */
            }

            button {
                padding: 0.7rem 1.4rem; /* Smaller button padding */
                font-size: 0.95rem; /* Smaller button font */
            }
        }

        /* Further optimization for very small screens */
        @media (max-width: 480px) {
            header h1 {
                font-size: 1.2rem; /* Even smaller font for very small mobile header */
            }
            nav a {
                font-size: 0.65rem; /* Even smaller font for very small mobile nav links */
                padding: 2px 0.05rem; /* Even tighter padding */
            }
        }

        /* New rule for consistent vertical alignment of contact section heading and content */
        section#contact {
            padding-top: 2rem;
            padding-bottom: 2rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center; /* Ensures text inside is centered */
        }

        /* Remove default h2 top margin specifically within the contact section */
        section#contact h2 {
            margin-top: 0;
        }

        /* Footer Styles */
        footer {
            background-color: #001f3f; /* A dark blue, similar to your header */
            color: #e0f2f7; /* Light text color */
            padding: 1.5rem 0; /* Vertical padding, no horizontal padding needed if text-align is center */
            text-align: center; /* This centers inline-level content like text */
            font-size: 0.9rem;
            box-shadow: 0 -4px 15px rgba(0,0,0,0.1);
            margin-top: 3.5rem; /* Space from the content above */
        }

        footer p {
            margin: 0; /* Remove default margins from the paragraph inside the footer */
        }
    </style>
</head>
<body>

    <header>
        <h1>samRad Health Technologies</h1>
        <nav class="nav-links">
            <a href="#about">About</a>
            <a href="#services">Services</a>
            <a href="#continuous-improvement">Advancements</a>
            <a href="#certifications">Certifications</a>
            <a href="#quiz">Imaging & Quiz</a>
            <a href="#contact">Contact</a>
        </nav>
    </header>

    <div class="container">
        <section id="about" class="py-16 px-4 sm:px-6 lg:px-8 bg-gray-50 dark:bg-gray-800 rounded-lg shadow-md">
            <div class="max-w-4xl mx-auto text-center">
                <h2 class="text-4xl font-extrabold mb-6">About Us</h2>
                <p class="text-lg leading-relaxed mb-4">samRad Health Technologies is a visionary cancer research and healthtech enterprise. Our mission is to pioneer intelligent, automated systems that empower clinicians to detect and quantify tumors from radiological imaging with precision and ease. Our AI pipelines are open, transparent, and designed to speed up diagnostics and enhance medical research.</p>
                <p class="text-lg leading-relaxed mb-4">Founded by <strong>Samuel</strong> <strong>Khumbula (Takwirira,Barachel)</strong>, a Zimbabwean PhD student in Physics at the University of New Hampshire in the United States (starts Fall 2025, God willing), the initiative is rooted in a passion for oncology and a heartfelt commitment to expanding access to care. Coming from a background marked by economic hardship and limited access to advanced healthcare, <strong>Samuel</strong> has firsthand experience of the challenges faced by most most cancer patients.</p>
                <p class="text-lg leading-relaxed mb-4">Through resilience and a relentless pursuit of education, he now seeks to transform lives&mdash;not just through innovation, but by creating pathways for others from similar circumstances. samRad Health Technologies aspires to establish life changing partnerships with hospitals across Zimbabwe and the world,uplifting cancer care through technological excellence and shared knowledge.</p>
            </div>
        </section>

        <section id="services" class="py-16 px-4 sm:px-6 lg:px-8 bg-white dark:bg-gray-900 rounded-lg shadow-md mt-8">
            <div class="max-w-6xl mx-auto text-center">
                <h2 class="text-4xl font-extrabold mb-8">Our Services</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <div class="service-card bg-gray-100 dark:bg-gray-700 p-6 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300">
                        <h3 class="text-2xl font-bold mb-3">AI Tumor Detection</h3>
                        <p class="text-gray-600 dark:text-gray-300">Instant analysis of medical scan images (DICOM) to assess cancer risk using trained AI models.</p>
                    </div>
                    <div class="service-card bg-gray-100 dark:bg-gray-700 p-6 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300">
                        <h3 class="text-2xl font-bold mb-3">Clinical Pipeline Tooling</h3>
                        <p class="text-gray-600 dark:text-gray-300">Command-line tools for clinical researchers to process imaging data and patient datasets efficiently at scale.</p>
                    </div>
                    <div class="service-card bg-gray-100 dark:bg-gray-700 p-6 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300">
                        <h3 class="text-2xl font-bold mb-3">Data Integration & Interoperability</h3>
                        <p class="text-gray-600 dark:text-gray-300">Robust support for structured CSV metadata, clinical tagging, and export-ready research formats. Seamlessly integrate with existing hospital systems.</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="continuous-improvement" class="py-16 px-4 sm:px-6 lg:px-8 bg-gray-50 dark:bg-gray-800 rounded-lg shadow-md mt-8">
            <div class="max-w-4xl mx-auto text-center">
                <h2 class="text-4xl font-extrabold mb-6">Advancements</h2>
                <p class="text-lg leading-relaxed mx-auto">At samRad Health Technologies, our mission centers on <strong>precision</strong> in cancer detection and treatment. We are constantly working to bring advancements to cancer care through intelligent, automated systems that empower clinicians to detect and quantify tumors from radiological imaging with precision and ease.</p>
            </div>
        </section>

        <section id="certifications" class="py-16 px-4 sm:px-6 lg:px-8 bg-white dark:bg-gray-900 rounded-lg shadow-md mt-8">
            <div class="max-w-4xl mx-auto text-center">
                <h2 class="text-4xl font-extrabold mb-8">Certifications & Research Ethics</h2>
                <ul class="space-y-4 text-left max-w-2xl mx-auto">
                    <li class="text-lg">Fully compliant with <strong>HIPAA</strong> data handling protocols to ensure patient data privacy and security.</li>
                    <li class="text-lg">Model validation on ethically sourced, anonymized datasets to maintain integrity and prevent bias.</li>
                    <li class="text-lg">Strict adherence to <strong>IRB</strong> (Institutional Review Board) and institutional ethics review processes for all research and development.</li>
                </ul>
            </div>
        </section>

        <section id="quiz" class="py-16 px-4 sm:px-6 lg:px-8 bg-gray-50 dark:bg-gray-800 rounded-lg shadow-md mt-8">
            <div class="max-w-4xl mx-auto text-center">
                <h2 class="text-4xl font-extrabold mb-6">Imaging and Quiz</h2>
                <p class="text-lg leading-relaxed mb-4">Medical imaging&mdash;like MRI, CT, and PET scans&mdash;is often the first step in diagnosing and treating cancer. These tools guide decisions and shape care, but many people don’t fully understand what they are or how they work.</p>

                <p class="text-lg leading-relaxed mb-4">Early detection is especially critical for cancers like breast cancer, prostate cancer, and glioblastoma. Catching these diseases in their earliest stages can significantly improve treatment options, reduce the need for aggressive interventions, and boost survival rates.</p>

                <p class="text-lg leading-relaxed mb-4">At <strong>samRad Health Technologies</strong>, we’re developing software that helps detect tumors directly from medical images (DICOM files)&mdash;making diagnosis faster, earlier, and more accessible. Our goal is to support timely intervention, enable emerging treatment modalities, and ultimately improve patient outcomes.</p>

                <p class="text-lg leading-relaxed mb-4">Being informed can reduce fear, improve communication with your care team, and help you make confident choices.</p>

                <p class="text-lg leading-relaxed mb-4"><strong>Take the quiz to learn the basics and better navigate your health journey.</strong></p>

                <button id="start-quiz-btn" class="mt-8 px-8 py-4 bg-blue-600 text-white font-bold rounded-full shadow-lg hover:bg-blue-700 transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-blue-300">Start Quiz</button>
                <div id="quiz-form" class="mt-4"></div>
                <div id="quiz-result" class="mt-4"></div>
                <div id="highest-score-display" class="mt-4"></div>
            </div>
        </section>

        <section id="contact">
            <h2>Contact Us</h2>
            <p>Email: <a href="mailto:takwirira@proton.me">takwirira@proton.me</a></p>
            <p>GitHub: <a href="https://takwirira25.github.io/samRad-Health-Technologies/" target="_blank" rel="noopener noreferrer">https://takwirira25.github.io/samRad-Health-Technologies/</a></p>
        </section>
    </div>

    <footer>
        <p>&copy; 2025 samRad Health Technologies. All rights reserved.</p>
    </footer>

    <script type="module">
        // Import Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Firebase Configuration (using provided values and global variables)
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {
            apiKey: "AIzaSyBjIeqwWVoVKmaw_FBX4r9TVVtwurZegLE",
            authDomain: "samrad-974d2.firebaseapp.com",
            projectId: "samrad-974d2",
            storageBucket: "samrad-974d2.firebasestorage.app",
            messagingSenderId: "847594732342",
            appId: "1:847594732342:web:c231043fa5e95a6de8d197",
            measurementId: "G-CE1KVWE2T6"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        let userId = null; // To store the authenticated user ID
        let highestScoreDisplay = null; // Declare globally to be accessible

        // Function to listen for highest score changes from Firestore
        function listenForHighestScore() {
            if (!db) {
                console.error("Firestore instance is not available yet. Cannot listen for scores.");
                return;
            }
            if (!highestScoreDisplay) {
                highestScoreDisplay = document.getElementById('highest-score-display');
                if (!highestScoreDisplay) {
                    console.error("Element with ID 'highest-score-display' not found.");
                    return;
                }
            }

            console.log("Attempting to listen for highest score...");
            const quizResultsCollectionRef = collection(db, `artifacts/${appId}/public/data/quiz_results`);
            const q = query(quizResultsCollectionRef); // No orderBy to avoid index issues

            onSnapshot(q, (snapshot) => {
                console.log("Received Firestore snapshot for quiz results.");
                let highestPercentage = 0;
                if (snapshot.empty) {
                    console.log("No quiz results found in Firestore.");
                    highestScoreDisplay.innerHTML = "Highest Quiz Score Globally: <span style='color: #555;'>N/A (No results yet)</span>";
                    return;
                }

                snapshot.forEach((doc) => {
                    const data = doc.data();
                    console.log("Processing quiz result:", data);
                    if (data.percentage !== undefined && data.percentage > highestPercentage) {
                        highestPercentage = data.percentage;
                    }
                });
                highestScoreDisplay.innerHTML = `Highest Quiz Score Globally: <span style="color: #28a745;">${highestPercentage}%</span>`;
            }, (error) => {
                console.error("Error listening for highest score from Firestore:", error);
                highestScoreDisplay.innerHTML = "Error loading highest score.";
            });
        }


        // Authenticate user and then start listening for highest score
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                userId = user.uid;
                console.log("Firebase authenticated. User ID:", userId);
                listenForHighestScore(); // Call after userId is set
            } else {
                try {
                    const userCredential = await signInAnonymously(auth);
                    userId = userCredential.user.uid;
                    console.log("Signed in anonymously. User ID:", userId);
                    listenForHighestScore(); // Call after userId is set
                } catch (error) {
                    console.error("Error signing in anonymously:", error);
                }
            }
        });

        // Function to throttle scroll events for performance
        function throttle(func, limit) {
            let inThrottle;
            return function() {
                const args = arguments;
                const context = this;
                if (!inThrottle) {
                    func.apply(context, args);
                    inThrottle = true;
                    setTimeout(() => inThrottle = false, limit);
                }
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM Content Loaded: Initializing website scripts.');

            const headerTitle = document.querySelector('header h1');
            const navLinks = document.querySelector('nav.nav-links');
            const menuToggle = document.querySelector('.menu-toggle');
            const header = document.querySelector('header');

            // Initialize highestScoreDisplay here, as it's a DOM element
            highestScoreDisplay = document.getElementById('highest-score-display');


            if (!headerTitle || !navLinks || !header) {
                console.warn('Required header elements for mobile menu or scrolling not found. Some header functionalities might be impacted.');
            }

            if (menuToggle) {
                menuToggle.addEventListener('click', () => {
                    if (navLinks) {
                        navLinks.classList.toggle('active');
                    }
                    menuToggle.classList.toggle('active');
                });
            }

            if (navLinks) {
                navLinks.querySelectorAll('a').forEach(link => {
                    link.addEventListener('click', () => {
                        if (navLinks.classList.contains('active')) {
                            navLinks.classList.remove('active');
                            if (menuToggle) {
                                menuToggle.classList.remove('active');
                            }
                        }
                    });
                });
            }

            const sections = document.querySelectorAll('section'); // Selects all sections
            const highlightActiveSection = () => {
                let currentActive = null;
                const headerHeight = header ? header.offsetHeight : 0;

                sections.forEach(section => {
                    // Calculate section top relative to the viewport, considering scroll position
                    const sectionTop = section.offsetTop - headerHeight - 60; // Offset for header and some padding
                    const sectionBottom = sectionTop + section.offsetHeight;

                    if (window.scrollY >= sectionTop && window.scrollY < sectionBottom) {
                        currentActive = section.id;
                    }
                });

                // Remove 'active' class from all nav links first
                navLinks.querySelectorAll('a').forEach(link => {
                    link.classList.remove('active');
                });

                // Add 'active' class to the current section's nav link
                if (currentActive) {
                    const activeLink = document.querySelector(`nav.nav-links a[href="#${currentActive}"]`);
                    if (activeLink) {
                        activeLink.classList.add('active');
                    }
                }
            };

            window.addEventListener('scroll', throttle(highlightActiveSection, 100));
            highlightActiveSection(); // Initial call to set active section on load

            // Quiz functionality
            const startQuizBtn = document.getElementById('start-quiz-btn');
            const quizFormDiv = document.getElementById('quiz-form');
            const quizResultDiv = document.getElementById('quiz-result');

            // Expanded list of quiz questions
            const allQuizQuestions = [
                {
                    question: "What does MRI stand for?",
                    options: [
                        "Magnetic Resonance Imaging",
                        "Medical Radiation Instrument",
                        "Molecular Resonance Induction",
                        "Magnetic Resonance Information"
                    ],
                    answer: "Magnetic Resonance Imaging"
                },
                {
                    question: "Which imaging technique uses X-rays to create cross-sectional images of the body?",
                    options: [
                        "MRI",
                        "Ultrasound",
                        "CT Scan",
                        "PET Scan"
                    ],
                    answer: "CT Scan"
                },
                {
                    question: "What is the primary purpose of a PET scan in cancer diagnosis?",
                    options: [
                        "To create detailed anatomical images",
                        "To measure bone density",
                        "To detect metabolic activity and identify cancerous cells",
                        "To visualize blood flow"
                    ],
                    answer: "To detect metabolic activity and identify cancerous cells"
                },
                {
                    question: "Early detection of cancer generally leads to:",
                    options: [
                        "More aggressive treatments",
                        "Fewer treatment options",
                        "Improved treatment outcomes and survival rates",
                        "No significant change in prognosis"
                    ],
                    answer: "Improved treatment outcomes and survival rates"
                },
                {
                    question: "What type of radiation is typically used in radiation therapy for cancer treatment?",
                    options: [
                        "Alpha particles",
                        "Beta particles",
                        "Gamma rays or X-rays",
                        "Ultraviolet light"
                    ],
                    answer: "Gamma rays or X-rays"
                },
                {
                    question: "Which professional is primarily responsible for ensuring the accurate delivery of radiation dose in cancer treatment?",
                    options: [
                        "Oncologist",
                        "Radiation Therapist",
                        "Medical Physicist",
                        "Radiologist"
                    ],
                    answer: "Medical Physicist"
                },
                {
                    question: "What is the unit of absorbed radiation dose?",
                    options: [
                        "Becquerel (Bq)",
                        "Gray (Gy)",
                        "Sievert (Sv)",
                        "Curie (Ci)"
                    ],
                    answer: "Gray (Gy)"
                },
                {
                    question: "Which of the following is NOT a common type of external beam radiation therapy?",
                    options: [
                        "Intensity-Modulated Radiation Therapy (IMRT)",
                        "Proton Therapy",
                        "Brachytherapy",
                        "Stereotactic Body Radiation Therapy (SBRT)"
                    ],
                    answer: "Brachytherapy"
                },
                {
                    question: "What is the main advantage of proton therapy over traditional X-ray therapy?",
                    options: [
                        "It is less expensive",
                        "It causes no side effects",
                        "It delivers a more precise dose to the tumor with less exit dose",
                        "It uses lower radiation doses"
                    ],
                    answer: "It delivers a more precise dose to the tumor with less exit dose"
                },
                {
                    question: "What is the purpose of a CT simulation in radiation oncology?",
                    options: [
                        "To diagnose new tumors",
                        "To plan the radiation treatment by mapping the tumor and surrounding organs",
                        "To monitor the patient's response to chemotherapy",
                        "To perform surgery"
                    ],
                    answer: "To plan the radiation treatment by mapping the tumor and surrounding organs"
                },
                {
                    question: "Which principle states that radiation dose should be kept as low as reasonably achievable?",
                    options: [
                        "ALARA (As Low As Reasonably Achievable)",
                        "LNT (Linear No-Threshold)",
                        "ORM (Occupational Radiation Monitoring)",
                        "RSO (Radiation Safety Officer)"
                    ],
                    answer: "ALARA (As Low As Reasonably Achievable)"
                },
                {
                    question: "What is the role of a dosimetrist in a radiation oncology department?",
                    options: [
                        "To operate the radiation therapy machine",
                        "To prescribe the radiation dose",
                        "To design the radiation treatment plan and calculate dose distributions",
                        "To provide psychological support to patients"
                    ],
                    answer: "To design the radiation treatment plan and calculate dose distributions"
                },
                {
                    question: "Which type of radiation is emitted from radioactive isotopes used in brachytherapy?",
                    options: [
                        "Microwaves",
                        "Radio waves",
                        "Gamma rays or Beta particles",
                        "Infrared light"
                    ],
                    answer: "Gamma rays or Beta particles"
                },
                {
                    question: "What is image-guided radiation therapy (IGRT) used for?",
                    options: [
                        "To take pictures of the tumor before treatment",
                        "To adjust patient position and target delivery in real-time during treatment",
                        "To identify the type of cancer",
                        "To reduce the need for radiation"
                    ],
                    answer: "To adjust patient position and target delivery in real-time during treatment"
                },
                {
                    question: "The half-life of a radioactive isotope refers to the time it takes for:",
                    options: [
                        "Half of the original atoms to decay",
                        "All of the original atoms to decay",
                        "The radiation to stop being harmful",
                        "The patient to recover from treatment"
                    ],
                    answer: "Half of the original atoms to decay"
                }
            ];

            const QUIZ_QUESTIONS_PER_SESSION = 10;
            let currentQuizQuestions = []; // Array to hold the questions for the current quiz session

            let currentQuestionIndex = 0;
            let score = 0;

            // Fisher-Yates (Knuth) shuffle algorithm
            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]]; // Swap elements
                }
                return array;
            }

            function startNewQuiz() {
                // Shuffle all questions and select the first 10
                currentQuizQuestions = shuffleArray([...allQuizQuestions]).slice(0, QUIZ_QUESTIONS_PER_SESSION);
                currentQuestionIndex = 0;
                score = 0;
                startQuizBtn.style.display = 'none'; // Ensure start button is hidden
                displayQuestion();
            }

            function displayQuestion() {
                if (currentQuestionIndex < currentQuizQuestions.length) {
                    const q = currentQuizQuestions[currentQuestionIndex];
                    quizFormDiv.innerHTML = `
                        <p class="text-xl font-semibold mb-4">${currentQuestionIndex + 1}. ${q.question}</p>
                        ${q.options.map((option) => `
                            <label>
                                <input type="radio" name="quiz-option" value="${option}">
                                <span>${option}</span>
                            </label>
                        `).join('')}
                    `;
                    // Add event listeners to radio buttons for immediate check
                    quizFormDiv.querySelectorAll('input[name="quiz-option"]').forEach(radio => {
                        radio.addEventListener('change', checkAnswer);
                    });
                    quizResultDiv.innerHTML = ''; // Clear previous result
                } else {
                    displayFinalResult();
                }
            }

            function checkAnswer(event) {
                // Get the selected option from the event target
                const selectedOption = event.target;
                if (selectedOption) {
                    const userAnswer = selectedOption.value;
                    const correctAnswer = currentQuizQuestions[currentQuestionIndex].answer;

                    if (userAnswer === correctAnswer) {
                        score++;
                        quizResultDiv.innerHTML = '<p class="text-green-600 font-bold">Correct!</p>';
                    } else {
                        quizResultDiv.innerHTML = `<p class="text-red-600 font-bold">Incorrect. The correct answer was: ${correctAnswer}</p>`;
                    }

                    // Disable all radio buttons for the current question after an answer is selected
                    quizFormDiv.querySelectorAll('input[name="quiz-option"]').forEach(radio => {
                        radio.disabled = true;
                    });

                    currentQuestionIndex++;
                    setTimeout(displayQuestion, 1500); // Wait a bit before showing next question
                }
            }

            async function saveQuizResult(finalScore, totalQuestions) {
                if (!userId) {
                    console.error("User not authenticated. Cannot save quiz result.");
                    return;
                }
                const percentage = (finalScore / totalQuestions) * 100;
                try {
                    console.log("Attempting to save quiz result to Firestore...");
                    // Public data path: /artifacts/{appId}/public/data/{your_collection_name}
                    const quizResultsCollectionRef = collection(db, `artifacts/${appId}/public/data/quiz_results`);
                    await addDoc(quizResultsCollectionRef, {
                        userId: userId,
                        score: finalScore,
                        totalQuestions: totalQuestions,
                        percentage: parseFloat(percentage.toFixed(2)), // Store with 2 decimal places
                        timestamp: new Date()
                    });
                    console.log("Quiz result saved successfully!");
                } catch (e) {
                    console.error("Error adding document to Firestore:", e);
                    // Provide user feedback on failure
                    quizResultDiv.innerHTML += `<p class="text-red-600">Error saving your score: ${e.message}. Please check console for details.</p>`;
                }
            }

            function displayFinalResult() {
                quizFormDiv.innerHTML = '';
                quizResultDiv.innerHTML = `
                    <p class="text-2xl font-bold text-blue-800">Quiz Complete!</p>
                    <p class="text-xl mt-2">You scored ${score} out of ${currentQuizQuestions.length}.</p>
                    <button id="restart-quiz-btn" class="mt-6">Restart Quiz</button>
                `;
                document.getElementById('restart-quiz-btn').addEventListener('click', () => {
                    startNewQuiz(); // Directly start a new quiz
                });

                // Save the result to Firebase
                saveQuizResult(score, currentQuizQuestions.length);
            }

            startQuizBtn.addEventListener('click', () => {
                startNewQuiz();
            });
        });
    </script>
</body>
</html>
